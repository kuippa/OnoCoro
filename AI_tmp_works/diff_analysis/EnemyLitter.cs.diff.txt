Change Type: significant_change
ILSpy: g:\unity\OnoCoro2026\Assets\Recovery\.Editor\ILspy_CS\EnemyLitter.cs
Scripts: g:\unity\OnoCoro2026\Assets\Scripts\Enemy\EnemyLitter.cs
================================================================================

--- EnemyLitter.cs+++ EnemyLitter.cs@@ -1,306 +1,176 @@-// Assembly-CSharp, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null
-// EnemyLitter
-using System;
 using System.Collections;
 using System.Collections.Generic;
+using UnityEngine;
+using UnityEngine.UI;
 using CommonsUtility;
-using UnityEngine;
-using UnityEngine.AI;
 
 public class EnemyLitter : MonoBehaviour
 {
-	private NavMeshAgent _NavMeshAgent;
+    private EnemyStatus myStatus;
+    // private GameObject myUnit = new GameObject();
+    // private GameObject myUnit;
+    // 時間間隔を保持する変数
+    private float _t = 0f;
+    private int _child_count = 0;
 
-	private EnemyStatus _myStatus;
+    [SerializeField]
+    public float _TimeDistance = 0.08f;
+    public float _LitteringPow = 300f;
+    public int _MaxLitters = 50;
+    public float _LitterSizeMin = 0.05f;
+    public float _LitterSizeMax = 0.10f;
+    public float _LitterMass = 80f;
+    public bool _LittingMode = true;   // true: 一定時間ごとに生成する false: 生成しない
 
-	private int _child_count;
+    public void CreateLitterUnit(Vector3 position)
+    {
+        #if UNITY_EDITOR
+            Debug.Log(this.GetType().FullName + " " + System.Reflection.MethodBase.GetCurrentMethod().Name);
+        #endif
 
-	private Vector3[] _myPaths;
+        this.tag = GameEnum.TagType.EnemyLitters.ToString();
+        int idx = GameObjectTreat.IndexObjectByTag(this.tag);
+        this.name = this.tag + idx;
+        myStatus = new EnemyStatus();
+        myStatus.SetEnemyName(this.name);
 
-	private const float LITTER_CHECK = 1f;
+        // this.transform.position = new Vector3(0 + idx * 0.5f, 0.5f, -6);
+        this.transform.position = new Vector3(position.x + idx * 0.5f, position.y, position.z);
+        this.transform.localScale = new Vector3(0.4f, 0.4f, 0.4f);
+        Vector3 setPoint = this.transform.position;
 
-	private const float THROW_ANGLE = 65f;
+        Quaternion setRotation = Quaternion.Euler(0, rdNum(0,360), 0);
+        this.transform.rotation = setRotation;
 
-	private const float MOVING_CHECK = 1.5f;
 
-	private Vector3 _undefine_pos = new Vector3(-99f, -99f, -99f);
+    }
 
-	internal static int _idx;
+    private bool MakeChildLitter()
+    {
+        #if UNITY_EDITOR
+            Debug.Log(this.GetType().FullName + " " + System.Reflection.MethodBase.GetCurrentMethod().Name);
+        #endif
+        // 子供要素数がXX以上ならこれ以上生成をおこなわない
+        // if (myUnit.transform.childCount >= _MaxLitters)
+        if (_child_count >= _MaxLitters)
+        {
+            _child_count = 0;
+            _LittingMode = false;
+            return false;
+        }
+        myStatus = new EnemyStatus();
+        myStatus.SetEnemyName(GameEnum.TagType.Garbage.ToString());
+		GameObject prefab = Resources.Load<GameObject>("Prefabs/GarbageCube");
+        prefab.transform.localScale = GetRandomSize(_LitterSizeMin, _LitterSizeMax);
+        Vector3 setPoint = this.transform.position;
+        Quaternion setRotation = Quaternion.Euler(rdNum(0,360), rdNum(0,360), rdNum(0,360));
+        GameObject unit = Instantiate(prefab, setPoint, setRotation);
+        // unit.tag = "Garbage";
+        unit.tag = GameEnum.TagType.Garbage.ToString();
+        Rigidbody rigidbody = unit.GetComponent<Rigidbody>();
+        // rigidbody.useGravity = true;
+        // Rigidbody rb        = GetComponent<Rigidbody>();
+        // Rigidbody rigidbody = unit.AddComponent<Rigidbody>();
+        rigidbody.AddForce(transform.forward * _LitteringPow);
+        unit.transform.SetParent(this.transform);
 
-	private Vector3 _throw_direction = new Vector3(0f, 0f, 0f);
+        _child_count++;
+        return true;
+    }
 
-	private Vector3 _target_position = new Vector3(0f, 0f, 0f);
+    private Vector3 GetRandomSize(float min, float max)
+    {
+        Vector3 size = new Vector3(
+                rdNum(min, max), 
+                rdNum(min, max), 
+                rdNum(min, max)
+                );
+        return size;
+    }
 
-	private float _target_radius;
+    void Awake()
+    {
+        #if UNITY_EDITOR
+            Debug.Log(this.GetType().FullName + " " + System.Reflection.MethodBase.GetCurrentMethod().Name);
+        #endif
+        // GameConfig.InitGameConfig();
 
-	private int _num_of_monitoring;
+        // // this.tag = "EnemyLitters";
+        // this.tag = GameEnum.TagType.EnemyLitters.ToString();
+        // int idx = GameObjectTreat.IndexObjectByTag(this.tag);
+        // this.name = this.tag + idx;
+        // myStatus = new EnemyStatus();
+        // myStatus.SetEnemyName(this.name);
+		// // GameObject prefab = Resources.Load<GameObject>("Prefabs/EnemyLitter");
+        // // myUnit = GameObject.CreatePrimitive(PrimitiveType.Cylinder);
 
-	private int _MaxLitters = 20;
+        // // prefab.transform.localScale = GetRandomSize(_LitterSizeMin, _LitterSizeMax);
+        // // myUnit.transform.position = new Vector3(0 + idx * 0.5f, 0.5f, -6);
+        // // myUnit.transform.localScale = new Vector3(0.4f, 0.4f, 0.4f);
+        // // Vector3 setPoint = myUnit.transform.position;
 
-	private bool _LittingMode = true;
+        // // prefab.transform.position = new Vector3(0 + idx * 0.5f, 0.5f, -6);
+        // // prefab.transform.localScale = new Vector3(0.4f, 0.4f, 0.4f);
+        // // Vector3 setPoint = prefab.transform.position;
 
-	private bool _MovingMode = true;
+        // this.transform.position = new Vector3(0 + idx * 0.5f, 0.5f, -6);
+        // this.transform.localScale = new Vector3(0.4f, 0.4f, 0.4f);
+        // Vector3 setPoint = this.transform.position;
 
-	internal void CreateLitterUnit(Vector3 position)
-	{
-		int num = GameObjectTreat.IndexObjectByTag(base.tag);
-		base.name = base.tag + num;
-		_myStatus = GetEnemyStatus();
-		_myStatus.SetEnemyName(base.name);
-		base.transform.position = position;
-	}
 
-	private EnemyStatus GetEnemyStatus()
-	{
-		if (_myStatus == null)
-		{
-			_myStatus = new EnemyStatus();
-		}
-		return _myStatus;
-	}
 
-	internal void SetThrowOutDirection(GameObject targetObj = null)
-	{
-		if (targetObj == null)
-		{
-			_target_position = new Vector3(0f, 0f, 0f);
-			_target_radius = 0f;
-			ChangeHeadColor(-1);
-		}
-		else
-		{
-			_target_position = targetObj.transform.position;
-			_target_radius = targetObj.GetComponent<DustBoxCtrl>().GetRadius();
-			ChangeHeadColor(1);
-		}
-	}
+        // // Quaternion setRotation = Quaternion.Euler(rdNum(0,360), rdNum(0,360), rdNum(0,360));
+        // // Quaternion setRotation = Quaternion.Euler(rdNum(0,360), rdNum(0,360), 0);
+        // Quaternion setRotation = Quaternion.Euler(0, rdNum(0,360), 0);
+        // // Quaternion setRotation = Quaternion.Euler(0, 0, 0);
+        // // GameObject unit = Instantiate(prefab, setPoint, setRotation);
+        // // myUnit = Instantiate(prefab, setPoint, setRotation);
+        // this.transform.rotation = setRotation;
 
-	internal void ChangeHeadColor(int monit)
-	{
-		_num_of_monitoring += monit;
-		Renderer component = base.transform.Find("CapsuleHead").GetComponent<Renderer>();
-		if (_num_of_monitoring > 0)
-		{
-			component.material = MaterialManager.Material_BG_Green;
-		}
-		else
-		{
-			component.material = MaterialManager.Material_BG_RED;
-		}
-	}
+        // Rigidbody rigidbody = myUnit.AddComponent<Rigidbody>();
+        // rigidbody.useGravity = true;
+        // rigidbody.mass = _LitterMass;
+        // rigidbody.constraints = 
+        //     // RigidbodyConstraints.FreezePositionX | 
+        //     // RigidbodyConstraints.FreezePositionY | 
+        //     // RigidbodyConstraints.FreezePositionZ | 
+        //     RigidbodyConstraints.FreezeRotationX | 
+        //     RigidbodyConstraints.FreezeRotationY | 
+        //     RigidbodyConstraints.FreezeRotationZ;
 
-	private Vector3 GetThrowOutDirection()
-	{
-		if (_target_position != new Vector3(0f, 0f, 0f))
-		{
-			return (_target_position - base.transform.position).normalized;
-		}
-		return base.transform.forward;
-	}
+        // myUnit.transform.SetParent(this.transform);
 
-	private float GetTargetDistance()
-	{
-		float result = 0f;
-		if (_target_position != new Vector3(0f, 0f, 0f))
-		{
-			result = Vector3.Distance(base.transform.position, _target_position);
-		}
-		return result;
-	}
+        // 衝突判定用のコライダーを追加
 
-	private float GetThrowOutSpeed()
-	{
-		if (_target_position != new Vector3(0f, 0f, 0f))
-		{
-			float targetDistance = GetTargetDistance();
-			float num = MathF.PI * 13f / 36f;
-			float num2 = 9.8f;
-			return Mathf.Sqrt(targetDistance * num2 / Mathf.Sin(2f * num));
-		}
-		return 4.43f;
-	}
 
-	private bool MakeChildLitter()
-	{
-		if (_child_count >= _MaxLitters)
-		{
-			_child_count = 0;
-			_LittingMode = false;
-			return false;
-		}
-		float targetDistance = GetTargetDistance();
-		if ((targetDistance > _target_radius || targetDistance == 0f) && _num_of_monitoring > 0)
-		{
-			return false;
-		}
-		GameObject gameObject = GarbageCubeCtrl.SpawnGarbageCube(base.transform.Find("Hand").position, 1);
-		if (gameObject == null)
-		{
-			return false;
-		}
-		Rigidbody component = gameObject.GetComponent<Rigidbody>();
-		float throwOutSpeed = GetThrowOutSpeed();
-		Vector3 throwOutDirection = GetThrowOutDirection();
-		Vector3 linearVelocity = throwOutDirection * throwOutSpeed;
-		linearVelocity.y = throwOutSpeed * Mathf.Sin(MathF.PI * 13f / 36f);
-		linearVelocity.x = throwOutSpeed * Mathf.Cos(MathF.PI * 13f / 36f) * throwOutDirection.x;
-		linearVelocity.z = throwOutSpeed * Mathf.Cos(MathF.PI * 13f / 36f) * throwOutDirection.z;
-		component.linearVelocity = linearVelocity;
-		_child_count++;
-		return true;
-	}
+    }
 
-	private Vector3 GetRandomSize(float min, float max)
-	{
-		return new Vector3(rdNum(min, max), rdNum(min, max), rdNum(min, max));
-	}
+    private static float rdNum(float min, float max)
+    {
+        return Utility.fRandomRange(min, max);
+    }
 
-	private IEnumerator LitterDrops()
-	{
-		while (_LittingMode)
-		{
-			yield return new WaitForSeconds(1f);
-			MakeChildLitter();
-		}
-	}
+    void Update()
+    {
+        // 一定間隔で子供要素を生成
+        _t += Time.deltaTime;        
+        if (_t > _TimeDistance && _LittingMode)
+        {
+            MakeChildLitter();
+            #if UNITY_EDITOR
+                // Debug.Log(_t.ToString("0.00"));
+            #endif
+            _t = 0;
+        }
 
-	private IEnumerator MoveAgent()
-	{
-		while (_MovingMode)
-		{
-			yield return new WaitForSeconds(1.5f);
-			if (NavMeshCtrl.HasReachedDestination(_NavMeshAgent) && !SetNextPath(_myPaths))
-			{
-				_MovingMode = false;
-			}
-		}
-	}
+    }
 
-	private void AgentWasGoal()
-	{
-		GameObjectTreat.DestroyAll(base.gameObject);
-	}
 
-	private void AgentJumpToStartPosition()
-	{
-		base.gameObject.transform.position = _myPaths[0];
-	}
+    void OnDestroy()
+    {
+        #if UNITY_EDITOR
+            Debug.Log(this.GetType().FullName + " " + System.Reflection.MethodBase.GetCurrentMethod().Name);
+        #endif
+    }
 
-	private bool SetNextPath(Vector3[] paths)
-	{
-		if (paths == null || paths.Length == 0)
-		{
-			AgentWasGoal();
-			return false;
-		}
-		Vector3 destination = paths[0];
-		SetDestination(destination);
-		List<Vector3> list = new List<Vector3>(paths);
-		list.RemoveAt(0);
-		_myPaths = list.ToArray();
-		return true;
-	}
-
-	internal void ReachDustBox(Vector3 dustBoxPos)
-	{
-		SetNextPath(_myPaths);
-	}
-
-	internal void AddPathAndInterrupt(Vector3 path)
-	{
-		List<Vector3> list = new List<Vector3>(_myPaths);
-		if ((list.Count <= 0 || !(list[0] == path)) && !NavMeshCtrl.IsSameDestination(_NavMeshAgent, path))
-		{
-			list.Insert(0, path);
-			_myPaths = list.ToArray();
-			Vector3 vector = path;
-			Debug.Log("AddPathAndInterrupt:" + vector.ToString());
-			SetNextPath(_myPaths);
-		}
-	}
-
-	internal void SetPaths(string[] marker_names = null)
-	{
-		Vector3[] myPaths = _myPaths;
-		if (marker_names == null || marker_names.Length == 0)
-		{
-			myPaths = new Vector3[4]
-			{
-				GetMarkerPositionByName("path_marker_start"),
-				GetMarkerPositionByName("path_marker_01"),
-				GetMarkerPositionByName("path_marker_02"),
-				GetMarkerPositionByName("path_marker_goal")
-			};
-		}
-		else
-		{
-			myPaths = new Vector3[marker_names.Length];
-			int num = 0;
-			foreach (string text in marker_names)
-			{
-				Vector3 markerPositionByName = GetMarkerPositionByName(text.Trim());
-				if (markerPositionByName == _undefine_pos)
-				{
-					Array.Resize(ref myPaths, myPaths.Length - 1);
-					continue;
-				}
-				myPaths[num] = markerPositionByName;
-				num++;
-			}
-		}
-		_myPaths = myPaths;
-	}
-
-	private void SetDestination(Vector3 destination)
-	{
-		NavMeshCtrl.SetAgentSpeed(_NavMeshAgent);
-		if (!NavMeshCtrl.IsSameDestination(_NavMeshAgent, destination) && !NavMeshCtrl.SetNavMeshDestination(_NavMeshAgent, destination, base.transform))
-		{
-			Vector3 vector = destination;
-			Debug.Log("SetNavMeshDestination false:" + vector.ToString());
-		}
-	}
-
-	private Vector3 GetMarkerPositionByName(string markerName)
-	{
-		GameObject gameObject = GameObject.Find(markerName);
-		if (gameObject == null)
-		{
-			Debug.Log("GetMarkerPositionByName cannot find :" + markerName);
-			return _undefine_pos;
-		}
-		return gameObject.transform.position;
-	}
-
-	private static float rdNum(float min, float max)
-	{
-		return Utility.fRandomRange(min, max);
-	}
-
-	private void Awake()
-	{
-		_NavMeshAgent = NavMeshCtrl.GetNavMeshAgent(base.gameObject);
-		_idx++;
-	}
-
-	internal void InitUnitSpawn(string[] marker_names = null)
-	{
-		SetPaths(marker_names);
-		AgentJumpToStartPosition();
-		SetNextPath(_myPaths);
-		StartCoroutine(LitterDrops());
-		StartCoroutine(MoveAgent());
-	}
-
-	private void Start()
-	{
-	}
-
-	private void Update()
-	{
-	}
-
-	private void OnDestroy()
-	{
-	}
 }


================================================================================
Significant Changes: 342
-	private NavMeshAgent _NavMeshAgent;

+    private EnemyStatus myStatus;

+    private float _t = 0f;

+    private int _child_count = 0;

-	private EnemyStatus _myStatus;

+    [SerializeField]

+    public float _TimeDistance = 0.08f;

+    public float _LitteringPow = 300f;

+    public int _MaxLitters = 50;

+    public float _LitterSizeMin = 0.05f;

+    public float _LitterSizeMax = 0.10f;

+    public float _LitterMass = 80f;

+    public bool _LittingMode = true;   // true: 一定時間ごとに生成する false: 生成しない

-	private int _child_count;

+    public void CreateLitterUnit(Vector3 position)

+    {

+        #if UNITY_EDITOR

+            Debug.Log(this.GetType().FullName + " " + System.Reflection.MethodBase.GetCurrentMethod().Name);

+        #endif

-	private Vector3[] _myPaths;

