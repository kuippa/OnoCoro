Change Type: significant_change
ILSpy: g:\unity\OnoCoro2026\Assets\Recovery\.Editor\ILspy_CS\ItemAction.cs
Scripts: g:\unity\OnoCoro2026\Assets\Scripts\Item\ItemAction.cs
================================================================================

--- ItemAction.cs+++ ItemAction.cs@@ -1,105 +1,93 @@-// Assembly-CSharp, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null
-// ItemAction
+using System.Collections;
+using System.Collections.Generic;
 using UnityEngine;
+using UnityEngine.UI;
 using UnityEngine.InputSystem;
+using UnityEngine.EventSystems;
+using UnityEditor;
+using CommonsUtility;
 
 public class ItemAction : MonoBehaviour
 {
-	public static ItemAction instance;
+    public static ItemAction instance = null;
+    private static SpawnCtrl _spawnCtrl = null;
+    private static ItemHolderCtrl _itemHolderCtrl = null;
+    private static ItemStruct _item = new ItemStruct();
 
-	private static SpawnCtrl _spawnCtrl;
+    internal static void GetSelectedItem()
+    {
+        SpawnMarkerPointerCtrl.SetMarkerActive(false);
+        GameObject item_holder = GameObject.Find("ItemList");
+        GameObject selected = EventSystem.current.currentSelectedGameObject;
+        if (item_holder == null || selected == null)
+        {
+            return;
+        }
 
-	private static ItemHolderCtrl _itemHolderCtrl;
+        if (selected.name.StartsWith("Item_"))
+        {
+            _itemHolderCtrl = selected.GetComponent<ItemHolderCtrl>();
+            ItemStruct item = _itemHolderCtrl.GetItem();
+            _item = item;
+            if (LoupeCtrl.IsLoupe(item.Name))
+            {
+                return;
+            }
+            if (item.Name != null)
+            {
+                SpawnMarkerPointerCtrl.SetMarkerActive(true);
+            }
+            else
+            {
+                SpawnMarkerPointerCtrl.SetMarkerActive(false);
+            }
+            return;
+        }
 
-	private static ItemStruct _item;
+    }
 
-	internal static void SelectItem(int index)
-	{
-		GameObject itemList = GetItemList();
-		if (!(itemList == null) && itemList.transform.childCount >= index)
-		{
-			_itemHolderCtrl = itemList.transform.Find("Item_" + (index - 1)).gameObject.GetComponent<ItemHolderCtrl>();
-			if (_itemHolderCtrl != null)
-			{
-				_item = _itemHolderCtrl.SelectItem();
-			}
-		}
-	}
+    internal static void ActItemUse()
+    {
+        Vector2 mousePosision2 = Mouse.current.position.ReadValue();
+        _spawnCtrl = SpawnCtrl.Instance;
+        if (!_spawnCtrl.CallUnitByName(_item.Name))
+        {
+            return;
+        }
+        _item.Stack = -1;
+        _itemHolderCtrl.AddItemToHolder(_item);
+        SpawnMarkerPointerCtrl.SetMarkerActive(false);
+    }
 
-	private static GameObject GetItemList()
-	{
-		GameObject gameObject = GameObject.Find("ItemList");
-		if (gameObject == null)
-		{
-			Debug.Log("ItemAction GetItemList: item_list == null" + gameObject?.name);
-			return null;
-		}
-		return gameObject;
-	}
+    internal static bool IsItemSelected()
+    {
+        if (_item.Name == null)
+        {
+            return false;
+        }
+        return true;
+    }
+    
+    void OnDestory()
+    {
+        // Debug.Log(this.GetType().FullName + " " + System.Reflection.MethodBase.GetCurrentMethod().Name);
+        if (instance == this)
+        {
+            instance = null;
+        }
+    }
 
-	internal static string GetSelectedItemName()
-	{
-		return GetSelectedItem().Name;
-	}
+    void Awake()
+    {
+        // Debug.Log(this.GetType().FullName + " " + System.Reflection.MethodBase.GetCurrentMethod().Name);
+        if (instance == null)
+        {
+            instance = this;
+        }
+        // _spawnCtrl = GetSpawnCtrl();
+        _spawnCtrl = SpawnCtrl.Instance;
 
-	private static ItemStruct GetSelectedItem()
-	{
-		return _item;
-	}
+    }
 
-	private static ItemHolderCtrl GetItemHolderCtrl(ItemStruct item)
-	{
-		return _itemHolderCtrl;
-	}
 
-	internal static void ActItemUse()
-	{
-		ItemStruct selectedItem = GetSelectedItem();
-		Mouse.current.position.ReadValue();
-		_spawnCtrl = SpawnCtrl.Instance;
-		if (!_spawnCtrl.CallUnitByName(selectedItem.Name))
-		{
-			Debug.Log("ItemAction ActItemUse: CallUnitByName failed: " + selectedItem.Name);
-			return;
-		}
-		selectedItem.Stack = -1;
-		ItemHolderCtrl itemHolderCtrl = GetItemHolderCtrl(selectedItem);
-		if (itemHolderCtrl != null)
-		{
-			itemHolderCtrl.AddItemToHolder(selectedItem);
-			SpawnMarkerPointerCtrl.SetMarkerActive(isActive: false);
-		}
-		else
-		{
-			Debug.Log("ItemAction ActItemUse: item_holder == null" + itemHolderCtrl?.name);
-		}
-	}
-
-	internal static bool IsItemSelected()
-	{
-		ItemStruct selectedItem = GetSelectedItem();
-		if (selectedItem.Name == null)
-		{
-			return false;
-		}
-		_item = selectedItem;
-		return true;
-	}
-
-	private void OnDestory()
-	{
-		if (instance == this)
-		{
-			instance = null;
-		}
-	}
-
-	private void Awake()
-	{
-		if (instance == null)
-		{
-			instance = this;
-		}
-		_spawnCtrl = SpawnCtrl.Instance;
-	}
 }


================================================================================
Significant Changes: 153
-	public static ItemAction instance;

+    public static ItemAction instance = null;

+    private static SpawnCtrl _spawnCtrl = null;

+    private static ItemHolderCtrl _itemHolderCtrl = null;

+    private static ItemStruct _item = new ItemStruct();

-	private static SpawnCtrl _spawnCtrl;

+    internal static void GetSelectedItem()

+    {

+        SpawnMarkerPointerCtrl.SetMarkerActive(false);

+        GameObject item_holder = GameObject.Find("ItemList");

+        GameObject selected = EventSystem.current.currentSelectedGameObject;

+        if (item_holder == null || selected == null)

+        {

+            return;

+        }

-	private static ItemHolderCtrl _itemHolderCtrl;

+        if (selected.name.StartsWith("Item_"))

+        {

+            _itemHolderCtrl = selected.GetComponent<ItemHolderCtrl>();

+            ItemStruct item = _itemHolderCtrl.GetItem();

