#85 2024/3/26
パワーキューブの得点計算から
PlayerArmatureについてたカプセルコライダーをoffに
なんか接触判定が２回発生するようになっていたので。

PlateauInfoのStorageOriginalMaterialのところ、マテリアル[]が0で初期化されてたので、追加に失敗していた。new Material[1];

yamlから指定位置に指定ユニットのスポーンをおこなえるように変更

spawnCtrlへのアクセスをあとで変更/ClickCtrlにも同じコードがいる
BuildingBreakのマテリアル操作部分、おかしかったので修正

次回、まーった、お掃除ロボットがうまく動かないので見直し
看板につっかかる、吸引しないなど



#86 2024/3/27
SweeperCtrl、TowerSweeperあたりを集中してデバッグ。
onTriggerが発生しないキューブがなぜか生まれる。（マテリアルがInstanceになる？）
経路探索がおかしい。
次回、destinationの設定のタイミングや、MoveControlのタイミングを考慮。
もう、ほんと何もわからない。


#87 2024/4/10
TowerMoveCtrlを作って、スウィーパーの動きの部分をリファクタリング。
解決はしていないが、少しプログラム上の動きをシンプルに。
経路探索部分まだまだ怪しい。




# 2024/6/15
PLATEAU SDK for Unity 2.3.2 アップデート
PLATEAU SDK for Unity
Input System
Test Framework
Timeline
Visual Scripting
PLATEAU SDK-Toolkits for Unity 1.0.1
↑ エラーが出ているので削除
https://github.com/Project-PLATEAU/PLATEAU-SDK-Toolkits-for-Unity.git
Unity6に変更


# 2024/6/22
URPをHDRPに変更
https://docs.unity3d.com/ja/Packages/com.unity.render-pipelines.high-definition@10.5/manual/HDRP-Asset.html


window > レンダリング > HDRPウィザード
UnityでHDRPを使ってみた。
https://qiita.com/Upon/items/c40d8b3b5e5c6721053a


# 2024/6/27
HDRP対応
赤エラーと、ピンクマテリアルをなくす
bloomライトが機能しておらず苦戦。
SSGI、グローバルボリューム、三鷹駅前、ライトニング２など新しいシーンをつくってテストするが機能せず。今度、新しいプロジェクトをつくってテストする。

OffMeshLink の 動的操作


# 2024/6/28
D:\unity\TestLight\HDRPLight
を作成。HDRPの光源チェック
Assets/SampleSceneAssets/Controllers/ThirdPersonController/Character/Textures_Low/Armature_Body_Albedo1k.png

PlayerArmature
Geometry
Armature_Mesh
のマテリアル、サーフェス入力 BaseMapにこれらpngが設定されていないのではないか
arm,body,leg

フッターのライト
Spotlight_01b (23)
Spotlight_Spot_01b
LOD Group（これなに？）

Light_Spot_800lmオブジェクトに
Light(スポット、混合、円錐 放出4000ケルビン 800Lumen 範囲6)
HD Additional Light Data（これなに？）
Lens Flare(SRP)

HD Additional Light Data
https://docs.unity3d.com/ja/Packages/com.unity.render-pipelines.high-definition@10.5/manual/Light-Component.html


FloatingDust Sitting Area
に
visual EffectでFloatingDustで
ホコリがちらされている

Assets/SampleSceneAssets/Controllers/ThirdPersonController/Prefabs/NestedParentArmature_Unpack.prefab

Assets/SampleSceneAssets/Materials/General/EmissiveBulb_Mat.mat

この線でひっぱってくっつけるなにか懐かしのDAWエディター的な匂い感じるけど、これただただ単にpublicで宣言してるのを視覚的にしとるだけよね？ HDRP/Litがemission持ってたら解決してたことを回避してるだけ？？

シェーダーグラフ→HDRP→Unlitシェーダーグラフ

を作成し、floatのEmissionと、Color型のBaseColorをつくる。
Create nodeでbelndでこの２つの引数を割り当てる
Fragmentにoutをつなげる
シェーダーグラフを保存
そのシェーダーグラフをシェーダーにもつ発光マテリアルを作成
マテリアルの公開プロパティのEmissionとColorの値を設定
オブジェクトにマテリアルをセット
https://qiita.com/kazuma_f/items/b106a8b18de48c15a053


# 2024/6/29
オノコロの掲示板にbloom対応
チュートリアルMAPの建物がピンクのまま

シネマシーンのアセットを2→3.0.1

#88 2024/7/09

マテリアルの変更
お掃除ロボットの探索アルゴリズムの変更。
SweepCtrl.OnTriggerStayにいれてた負荷軽減処理がスイープの実行に難をあたえてたっぽい。感覚を0.1から0.02へ。
SetDestinationが思ったより負荷が高いようだ。重複している場合はSetDestinationをおこなわないなど軽減処理。まだ挙動がおかしい部分があるの次回ひきつづき


# 2024/7/13
スイーパークラスのプログラム変更
リファクタし、いろいろ書き換えたが思うように動かず。
claude.aiにリファクタしてもらう。
少し動くようになった。System.Linqを教えてもらう。
キューブが飛ぶなどしてパスが経路なしになったときなどの対応を書く必要がある。
3時間ぐらい


#89 2024/7/14
配信外でお掃除ロボットの探索移動アルゴリズムのリファクタリングをおこないました。
今日は、
んー。・・・。右クリックのイベントとかできたらUpdate、Deleteあたりのイベント実装（チュートリアルつづき）をしようかな


PlayerArmatureの下にいるPlayer Inputが
Input Systemの*.inputactions の受け皿になっていて、変更が反映されていなかったので変更


ひさかたぶりにInputSystemにさわったら大苦戦。ショートカットで１～５ボタンを押したときにアイテムセレクトをできるようにした。
次回：
アイテムセレクトされているときはスポーンタイルを呼び出すように変更する。


#90 2024/7/17
CreateBoxが表示されないことがある。シリアライズフィールドに変更してたのをコード記述にしたから？
クリックイベントやらTABメニューやらのコード側の見直し。見直しした結果、余計うごかなくなった。つらい。
コールのタイミングが怪しい。遅延実行されることがある？
次回・アイテム、クリック、スポーンあたりのクラスを見直し。
D:\unity\OnoCoro2024\Assets\Scripts\APP\PlayerInputs.cs
D:\unity\OnoCoro2024\Assets\Scripts\Tower\SpawnCtrl.cs
D:\unity\OnoCoro2024\Assets\Scripts\Item\ItemListCtrl.cs
D:\unity\OnoCoro2024\Assets\Scripts\Item\ItemCreateCtrl.cs
Assets\Scripts\Item\LoupeCtrl.cs
D:\unity\OnoCoro2024\Assets\Scripts\UI\ClickCtrl.cs
ここらへんを触った。


#91 2024/7/18
UIアイテムメニュー系のリファクタリング。
まだ挙動怪しいけれど、一時保留。ここまで。
次回はユニットの右クリックでユニット情報表示ウインドウの内容を表示する

#92 2024/7/26

TAB画面でアイテムを選択した状態でTAB→ スポーンマーカーが出ない
→TABメニュー非表示処理時に選択を解除することで回避


次回、
InfoWindowCtrl
ItemStruct CharcterStruct UnitStruct が混在していて、表示すべき情報が不明確
表示用の InfoStruct を作成して統一する


#93 2024/7/28
VSCodeの画面をONにしないまま作業をしていた。
InfoWindowまわりの修正
右クリック、左クリックをコールチンを使用した遅延実行に変更
キャラクタークラスを削除しUnitStructに変更
マーカー周りの修正など

次回、ユニット削除処理など


#94 2024/8/1
ModelsTypeなどをGameEnumに統合
パワーキューブ、ガベージなどの情報表示機能の追加拡充
情報ウィンドウから削除機能の実装
お掃除ロボの削除機能対応
削除したときの点数計算、およびオブジェクトの削除

次回
削除の進捗バー表示（プレファブをつくる）


#94 2024/8/2
ドキュメントフォルダの整理
スクリプトのUnitTestで使わないやつを.Editor落ち
三鷹市のエリアデータのインポート処理
CircularIndicatorを作成。削除の時間をカウントアップする用インジケーター
materialのcolorや、シェーダーのcolorなどがぶつかってうまく表示、動かず。大苦戦。

次回：
InfoWindowCtrl
private void CallCircularIndicator()
座標指定して表示



#95 2024/8/3
削除インジゲーターをオブジェクトに割り当てて表示できるように。
レガシーのテキストからテキストメッシュへ。
スイーパーのドックのマーカー 半透明エリアLit

次回：
建物治すボタン
建物消すボタン



#96 2024/8/7
PlateauInfoが肥大化しすぎ。
可読性と疎結合性をあげるためにInfoBoxの表示系と、Plateauの情報取得系、Plateauのその他操作系、
などより可読性と疎結合性をあげる、よいリファクタリング
→

PlateauInfoManager
PlateauObjectSelector
PlateauDataExtractor
PlateauUIManager
PlateauBuildingInteractor
これらのクラスに分割。Claudi.aiさんに頼んで
軽く手をつけたが地獄だった。
ちゃんと機能が全部乗っているかは謎。
次回、削除ボタン、建物破壊ボタンなど。

Camera.main のところ？


#97 2024/8/8
InfoWindowが右上のスコア画面や、デバッグウィンドウの上をクリックでもおきてる。 → グラフィックレイキャストを外した
削除機能、建物破壊ボタンなどを実装
ステージ三鷹駅前を実装中


Failed to create Physics Mesh from source mesh. One of the triangles is too large. It's recommended to tesselate the large triangles. Source mesh name: urf_d8e07dee-146f-4847-bd01-4b59e642a430

urf_d8e07dee-146f-4847-bd01-4b59e642a430
luse_6a7bd630-467d-40db-9f0c-3e98148cf208
urf_1f9174fb-4fd2-4fda-8073-4688f53ac8dd
urf_0fb04ace-953a-4ecd-8ac8-a1ca838a4d5f
urf_bf59f1d9-2c9b-4e30-99b2-4b2d6654ab8b
urf_910ab420-995f-4c45-ad24-468b831b44ec
urf_cdd02a4f-138e-42c0-b491-d90e57b6d365
urf_aa9b9415-84f3-4130-9698-bdc947cb4ed5
urf_fc14f035-fd4a-4b84-ab37-59a71d8d39ed
urf_8054f899-e79b-4dd5-9404-bab7f0987414
urf_397d23b3-f15b-4a04-b45d-480f39533d2f
urf_3abf2cac-76f1-4406-b0a6-880f07fb0f56
urf_61a50140-1d79-4352-a8f5-4ba0b98a6d1b
urf_1c837993-8e47-46a6-9d00-566a36e5dfd1
urf_774e6621-5895-4c67-98f7-5304b14ebb7b
urf_5f272cf5-a5f0-44c2-b431-17f445a5c64a


次回：
破壊時にリワンドボーナスに応じてガベージを放出する


#98 2024/08/09
今回：
削除ボタン、建物破壊ボタンなど。
リファクタリングつづき
他ステージ（環境

次回：
破壊時にリワンドボーナスに応じてガベージを放出する
エラーがちょいちょいでてるので修正


#99 2024/08/10

奈落の再調整、地面のすぐうえにリポップするように変更
ゴミを散らばるようにした
ゴミを大量呼び出しするとやはりコリジョン抜けがある
ゴミの衝突判定を連続的かつ動的に変更


次回：
建物破壊時にリワンドボーナスに応じてガベージを放出する
デックのマーカーが歪んでるの修正


#100 2024/08/12
建物破壊時に応じてガベージを放出する
/r /n
Environment.NewLine
UIBuildingInfo、onOkClickがDestroyAllで閉じていてAddListenerが二回目以降解除されていた。
分離されたPlateauUIManagerで、nullだったら再呼び出しするように変更。あまりきれいではない。

次回：
スポーンするガベージキューブをなにかの子供オブジェクトへ
デックのマーカーが歪んでるの修正
お掃除ロボットあいかわらず挙動が変

動画リンク
https://youtu.be/0OiOVoBdgc0



#101 2024/8/14
スポーンするガベージキューブをガベージキューブスの子供オブジェクトへ
デックのマーカーが歪んでるの修正
クリア機能：StageGoalCtrl
Platau tool kitの再インストール
_timer_eventsのキー（時間）が重複していたときにエラーになるのでListのDictionaryに変更
ステージクリアのテロップ実装
警告などのサブテロップ実装

次回：
タイトル画面に戻りますか？Yes/No ウィンドウ
得点などのイベントログを表示するウィンドウ



#102 2024/8/15
タイトル画面に戻りますか？Yes/No ウィンドウを実装した
await Task.Delay(delaytime)あたりの遅延実行で戸惑う。
ボタンがクリックできなかったのは親にグラフィック令キャスターがなかったから（またか！

次回：
得点取得などのイベントログを表示するウィンドウ左下UI


#103 2024/8/16
得点取得などのイベントログを表示する EventLogCtrl 実装
スコアコントロールで得点に変化があったときログ表示
ステージロードで建物が壊れたときも得点が減らされている。果たして・・・

次回：
カメラ、TABメニュー時視点動かないなど、環境光などの操作


#104 2024/8/18
テロップをイベントローダーYAMLに
StageEnvironment：地べた GameObject dem からマテリアルを取得して、そのマテリアルのBase UV mapping をUV0から Planarへ変更する関数
Sky and Fog Global Volume：スカイボックスのプレファブ準備
奈落のRaycast判定が動かなくなっていたのでまた再調整。悶絶。
アイテムクリエイトの整数判定の-1が抜けてたので修正。

次回：
カメラ関係の操作つづき
TABメニュー表示時、視点を動かさない
せっかくHDRPにしたので環境光とかカメラ操作まわりを実装



#105 2024/8/21

Sky and Fog Global Volumeのボリューム、ポストプロセッシングの露出などのカメラエフェクトを調整。
課題：TODO：
フィルムグレイン（ざらざら感）は遠方からのショットのときのみ強めたい
フォーカスモードのFarを鳥瞰図カメラのときを見ながら調整
フォグやFirl Grainなどを天気に合わせても調整したい


次回：
PlateauToolから天気や木や車を配置テスト（再び）
火事ユニットや消化器ユニットを作成


#106 2024/8/22
今日：
PlateauToolから天気や木や車を配置テスト
昨日今日大雨があったので、せっかくなので雨災害をToolKitkから。ToolKitのレンダリングを入れたら見た目が相当かわってしまった。
せっかくのHDRPなので水、海、川などをテスト実装。ケンタッキーに海はない。
川もつくってはみたがおもったものと違うので使い所がむずかしそう。雨を降らせる、やませるイベントを作成。

次回：
雨粒オブジェクトを作成。水面が高くなる水害イベント。



#107 2024/9/3
EscMenuCtrl
でエラーが出まくってる。
Invalid AABB aabb  // Axis-Aligned Bounding Box
Plateau Toolkit Environmentがらみのバグ
EscMenuCtrlで時止めしていたTime.timeScale = 0;が原因。応急処置。
Narakuからdemをstaticで切り出し。
雨降りオブジェクトを作る。

次回、降った雨がくっついて水たまりになるように



#108 2024/9/15
Github copilot のchatが使えるようになったと聞いて、使ってみる。

this.gameObject.Find().gameObjectのgameObjectはいらない。
this.transform.Findに

雨粒があつまったら水たまりになる機能をつくったけれども模式的にはつぶのままのほうがわかりやすいかもしれない。
それにものすごくGPUを食うようだ。おくらいりかもしれない。
挙動もあやしい。なぜかすごくY方向が上になることがあるようだ。
Physics.Raycastで雨粒とぶつかってる？レイヤー指定が効いていない可能性。

次回
焚き火あたり



#109 2024/9/18
止水板を実装
スポーンマスの回転を実装
Bonfireを再実装しようとして、
Visual Effect Graphを12.1.7 から 17.0.2に変更
Unity6のHDRP、Visual Effect Graph17.0.2、Bonfireのサンプルすらまともに動かないのはどうしてだろう？互換させる気はないのかな？


次回：
VFXどうしようかな。ちょっと調べておく。


#110 2024/9/22
三鷹大沢地区実装

動画撮影/プレゼン用



#111 2024/11/21
２ヶ月ぶりの当プロジェクト。Unity作業。
Unityを6βからLTSにアプデしました。
↓ マテリアルでなんか見たことないエラーおきてるのでちょいチェックして、
動くか確認しつつ、リハビリしようと思います。

Assertion failed on expression: '!(o->TestHideFlag(Object::kDontSaveInEditor) && (options & kAllowDontSaveObjectsToBePersistent) == 0)'
UnityEngine.GUIUtility:ProcessEvent (int,intptr,bool&)


今回：
リハビリがてら簡単なスイッチボックスのプレファブ作成。
リハビリがてら簡単なスイッチボックスのプレファブ作成。
UnityをβからLTSに変えたので、VFXのbonefireとか治ってると期待したが、サンプルを読み込んだ時点で致命的エラー。どうしろと。Editorに移しても解決しないのでサンプルを消す。
VFX本格的にわからん。
次回：チュートリアルマップを流れで


#112 2024/11/28
Free Fire VFX - HDRPアセットを入れてみる。
FireCube（火が燃えるUnit）と、火と隣接したらゴミが延焼するのを途中までつくる。

次回、
ゴミがBITが回収できない灰になるところと
火を消火する消火器ユニットを作成



#113 2024/11/29
Farming Game FX - MIssion を入れてみる。

今日：
画面上はほとんど変化がないが、火が燃料追加で大きくなる仕組みを実装するために、コードを書き直した。
ゴミが時間で燃焼する仕組み（まだ途中）
ゴミから灰になると得点取得ができなくなる仕組み（まだ途中）
Farming Game FX - MIssionアセットを入れて消火器実装（手をつけられなかった）

次回：
手をつけられなかった部分


#114 2024/12/04
一週間ぶりぐらい。まだ途中とあるけど、どこまで作ったんだっけか・・・？
思い出すところあたりから。
火が追加されるゴミで大きくなるようにした。
灰も掃除機でごみ収集されるようにした。
火をみつけると水を打ち出す消火栓っぽいものを実装（まだ途中）



次回：
消火栓や水をプレファブ、タワー化する。
奈落で、Ashと水をうける


#115 2024/12/10
Debugを書くたびに追加されてた
using System.Diagnostics
setting.jsonに下記を追加したうえで再起動したら治った。

    ,"csharp.suppressDotnetDiagnostic.CS0105": true,
    "omnisharp.enableRoslynAnalyzers": false,
    "omnisharp.enableEditorConfigSupport": false,
    "omnisharp.enableDecompilationSupport": false,
    "omnisharp.enableImportCompletion": false,
    "omnisharp.enableAsyncCompletion": false

また動かなくなった。
火が爆ぜて飛び火、延焼するところを作成した。
火をみつけると水を打ち出す消火栓っぽいものを実装（まだ途中）
消火栓や水をプレファブ、タワー化する。
奈落で、Ashと水をうける
をつくる。
予定。


#116 2024/12/12

建物のそばに火災が発生した場合、延焼、破壊
炎がすでに出ている状態でリペアされたときBurning OnTriggerEnter が発生しない
↓修正
燃えたあと、リペアしたときに火が残ってたら再度破壊される

FireCubeに重ねてスポーンポイントがおけないので修正

建物のそばに火があると建物が壊れるように変更。
火をみつけると水を打ち出す消火栓っぽいものを実装中。根本にあてるのにハードコーディンつまじった。
火にかぶせてスポーンできないのを修正。



#117 2024/12/13

IndexObjectByTagでindexで名前をつけている部分あやしい。
今回の作業内容：
なんとなく消火栓できたけど、延焼すると火が消せない。バランス調整要検討。
奈落で、Ashと水をうけるように変更。


次回：
チュートリアルマップ、スタート画面


#118 2024/12/15
チュートリアル進行に必要な看板などをいくつか追加。
流れで動作おかしな細かな部分を修正。

次回
虫眼鏡
道にブレイクや削除ボタンが出る
火や看板など何も表示されない
消火栓が右クリックで消せない
掃除機ロボがAshも回収するように(なってるのにターゲット取り残しがある)


#119 2024/12/16
UnityのオブジェクトでY軸方向に回転させたくないので、親オブジェクトにRigidbodyを追加したら、そこから弾丸オブジェクトを発射するのが外に出せなくなりました。どのように解決するべきですか？
親オブジェクトに持ってたrigidbodyをExtinguishingCylinderにつけかえ。Y軸固定をこちらに。ExtinguishingCylinderの下に、hoseやnozzleを移動。
こんどは右クリックが拾えなくなったので、水をbulletレイヤーに、除外レイヤーにbulletを追加
親オブジェクトにもコライダーを追加。ノズルポイントだけコライダーの外にでるように変更
IndexObjectByTagでインデックスとtagを密にしてしまったのがガン。




消火栓を削除できるようにした。弾丸射出などの機能不全を修正。
虫眼鏡の挙動を改善。
道が削除や破壊ボタンがあるのを対応。

次回：
ジャンプした時だけカメラアングルを少しだけ変える。



CLKがショートしたら全ユニット停止




今日はここまで！




    private float _targetTime = 3000;
    private float _time = 0;

    private void OnTriggerStay(Collider other)
    {
        _time += Time.fixedDeltaTime;
        if (_time >= _targetTime)
        {
            _time -= _targetTime;
        }
    }







----

シーン遷移時の処理
[PostProcessScene( 0 )]





作曲AI
https://app.suno.ai/


ロードローラーだっ！！のノリでトウキョートチョーだっ！！ 都庁が降ってくる



アセット 消防車
https://assetstore.unity.com/packages/3d/vehicles/land/fire-truck-46161
https://assetstore.unity.com/packages/3d/vehicles/xrloft-vehices-fireengines-175613

ambulance
https://assetstore.unity.com/packages/3d/vehicles/land/ambulance-70313


避難所開設
備蓄
ベッド、キッチン、トイレ（BKT）をいかに短時間に開設できるか






オープンデータ
東京消防庁 消火栓及び防火水槽等
https://catalog.data.metro.tokyo.lg.jp/dataset/t000017d0000000007

東京消防庁　本部及び消防署所在一覧
https://catalog.data.metro.tokyo.lg.jp/dataset/t000017d0000000001


ペストコントロール
イエネズミ
商業ビルで繁殖（発生）する
家、ビルでも増えて
３０ｍの緑化帯がないと、無尽蔵に増える

